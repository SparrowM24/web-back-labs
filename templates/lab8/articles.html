{% extends "base.html" %}

{% block lab %}–°—Ç–∞—Ç—å–∏{% endblock %}

{% block main %}
<div style="margin-bottom: 20px; padding: 10px; background: #f5f5f5;">
    <a href="/">–ì–ª–∞–≤–Ω–∞—è</a> | 
    <a href="/lab8/">–õ–∞–± 8</a> | 
    {% if current_user.is_authenticated %}
        <a href="/lab8/articles/">–°—Ç–∞—Ç—å–∏</a> | 
        <a href="/lab8/create_article/">–°–æ–∑–¥–∞—Ç—å</a> | 
        <a href="/lab8/stats/">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a> | 
        –ü—Ä–∏–≤–µ—Ç, {{ current_user.login }}! | 
        <a href="/lab8/logout/">–í—ã–π—Ç–∏</a>
    {% else %}
        <a href="/lab8/register/">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a> | 
        <a href="/lab8/login/">–í—Ö–æ–¥</a>
    {% endif %}
</div>

<style>
    .search-container {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 30px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .search-form {
        display: flex;
        gap: 10px;
        max-width: 600px;
        margin: 0 auto;
    }
    
    .search-input {
        flex: 1;
        padding: 12px 15px;
        border: 2px solid #4364ac;
        border-radius: 6px;
        font-size: 16px;
    }
    
    .search-button {
        padding: 12px 25px;
        background: #4364ac;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
    }
    
    .search-button:hover {
        background: #365899;
    }
    
    .search-results-info {
        text-align: center;
        margin: 15px 0;
        color: #666;
        font-style: italic;
    }
    
    .clear-search-link {
        color: #4364ac;
        text-decoration: none;
        margin-left: 10px;
    }
    
    .clear-search-link:hover {
        text-decoration: underline;
    }
    
    .article-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 25px;
        margin-top: 30px;
    }
    
    .article-card {
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        overflow: hidden;
        transition: transform 0.3s, box-shadow 0.3s;
        box-shadow: 0 2px 5px rgba(0,0,0,0.08);
    }
    
    .article-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .article-header {
        background: #f8f9fa;
        padding: 15px;
        border-bottom: 1px solid #e0e0e0;
    }
    
    .article-title {
        margin: 0 0 10px 0;
        color: #333;
        font-size: 1.3em;
    }
    
    .article-meta {
        font-size: 14px;
        color: #666;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .article-badge {
        padding: 3px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: bold;
    }
    
    .badge-public {
        background: #28a745;
        color: white;
    }
    
    .badge-private {
        background: #dc3545;
        color: white;
    }
    
    .article-content {
        padding: 15px;
        line-height: 1.5;
        color: #444;
    }
    
    .article-preview {
        margin: 10px 0;
        max-height: 100px;
        overflow: hidden;
        position: relative;
    }
    
    .article-preview::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 20px;
        background: linear-gradient(transparent, white);
    }
    
    .article-footer {
        padding: 15px;
        border-top: 1px solid #e0e0e0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .article-stats {
        font-size: 14px;
        color: #666;
    }
    
    .article-actions {
        display: flex;
        gap: 10px;
    }
    
    .btn {
        padding: 8px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        text-decoration: none;
        font-size: 14px;
        display: inline-block;
    }
    
    .btn-primary {
        background: #4364ac;
        color: white;
    }
    
    .btn-secondary {
        background: #6c757d;
        color: white;
    }
    
    .btn-danger {
        background: #dc3545;
        color: white;
    }
    
    .section-title {
        margin: 40px 0 20px 0;
        padding-bottom: 10px;
        border-bottom: 2px solid #4364ac;
        color: #333;
    }
    
    .empty-message {
        text-align: center;
        padding: 40px;
        color: #666;
        background: #f8f9fa;
        border-radius: 8px;
        margin: 20px 0;
    }
    
    .no-results {
        text-align: center;
        padding: 60px 20px;
        color: #666;
        font-size: 18px;
    }
</style>

<div class="container">
    <div class="search-container">
        <h2 style="text-align: center; margin-bottom: 20px; color: #333;">
            {% if search_query %}
                üîç –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
            {% else %}
                üìö –í—Å–µ —Å—Ç–∞—Ç—å–∏
            {% endif %}
        </h2>
        
        <form method="get" action="/lab8/articles/" class="search-form">
            <input type="text" 
                   name="search" 
                   class="search-input" 
                   placeholder="–ü–æ–∏—Å–∫ –ø–æ —Å—Ç–∞—Ç—å—è–º (—Ä–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π)..." 
                   value="{{ search_query }}"
                   autofocus>
            <button type="submit" class="search-button">–ù–∞–π—Ç–∏</button>
        </form>
        
        {% if search_query %}
            <div class="search-results-info">
                <strong>–ü–æ –∑–∞–ø—Ä–æ—Å—É "{{ search_query }}" –Ω–∞–π–¥–µ–Ω–æ:</strong>
                {% if current_user.is_authenticated %}
                    {{ user_articles|length }} –≤–∞—à–∏—Ö —Å—Ç–∞—Ç–µ–π + {{ public_articles|length }} –ø—É–±–ª–∏—á–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                {% else %}
                    {{ all_public_articles|length }} –ø—É–±–ª–∏—á–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π
                {% endif %}
                <a href="/lab8/articles/" class="clear-search-link">–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫</a>
            </div>
        {% endif %}
    </div>

    {% if current_user.is_authenticated %}
        <div style="text-align: center; margin-bottom: 30px;">
            <a href="/lab8/create_article/" class="btn btn-primary" style="padding: 12px 25px; font-size: 16px;">
                üìù –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å—Ç–∞—Ç—å—é
            </a>
        </div>

        {% if search_query and user_articles|length == 0 and public_articles|length == 0 %}
            <div class="no-results">
                <h3>üòï –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
                <p>–ü–æ –∑–∞–ø—Ä–æ—Å—É "{{ search_query }}" –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –Ω–∏ –≤–∞—à–∏—Ö —Å—Ç–∞—Ç–µ–π, –Ω–∏ –ø—É–±–ª–∏—á–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.</p>
                <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∏–ª–∏ <a href="/lab8/create_article/">—Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é —Å—Ç–∞—Ç—å—é</a>.</p>
            </div>
        {% else %}
            <!-- –ú–æ–∏ —Å—Ç–∞—Ç—å–∏ -->
            {% if user_articles %}
                <h3 class="section-title">–ú–æ–∏ —Å—Ç–∞—Ç—å–∏ ({{ user_articles|length }})</h3>
                <div class="article-grid">
                    {% for article in user_articles %}
                    <div class="article-card">
                        <div class="article-header">
                            <h3 class="article-title">{{ article.title }}</h3>
                            <div class="article-meta">
                                <span>–°–æ–∑–¥–∞–Ω–æ: {{ article.created_at.strftime('%d.%m.%Y') if article.created_at else '–ù–µ–¥–∞–≤–Ω–æ' }}</span>
                                <span class="article-badge {% if article.is_public %}badge-public{% else %}badge-private{% endif %}">
                                    {% if article.is_public %}üì¢ –ü—É–±–ª–∏—á–Ω–∞—è{% else %}üîí –ü—Ä–∏–≤–∞—Ç–Ω–∞—è{% endif %}
                                </span>
                            </div>
                        </div>
                        
                        <div class="article-content">
                            <div class="article-preview">
                                {{ article.article_text[:200] }}
                                {% if article.article_text|length > 200 %}...{% endif %}
                            </div>
                        </div>
                        
                        <div class="article-footer">
                            <div class="article-stats">
                                üëç {{ article.likes or 0 }} | üëÅÔ∏è {{ article.views or 0 }}
                            </div>
                            <div class="article-actions">
                                <a href="/lab8/article/{{ article.id }}/" class="btn btn-primary">–ß–∏—Ç–∞—Ç—å</a>
                                <a href="/lab8/edit_article/{{ article.id }}/" class="btn btn-secondary">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% elif not search_query %}
                <div class="empty-message">
                    <h3>üìù –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å—Ç–∞—Ç–µ–π</h3>
                    <p>–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é —Å—Ç–∞—Ç—å—é, –Ω–∞–∂–∞–≤ –∫–Ω–æ–ø–∫—É –≤—ã—à–µ!</p>
                </div>
            {% endif %}

            <!-- –ü—É–±–ª–∏—á–Ω—ã–µ —Å—Ç–∞—Ç—å–∏ –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
            {% if public_articles %}
                <h3 class="section-title">–ü—É–±–ª–∏—á–Ω—ã–µ —Å—Ç–∞—Ç—å–∏ –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ({{ public_articles|length }})</h3>
                <div class="article-grid">
                    {% for article in public_articles %}
                    <div class="article-card">
                        <div class="article-header">
                            <h3 class="article-title">{{ article.title }}</h3>
                            <div class="article-meta">
                                <span>–ê–≤—Ç–æ—Ä: {{ get_author_name(article.login_id) }}</span>
                                <span class="article-badge badge-public">üì¢ –ü—É–±–ª–∏—á–Ω–∞—è</span>
                            </div>
                        </div>
                        
                        <div class="article-content">
                            <div class="article-preview">
                                {{ article.article_text[:200] }}
                                {% if article.article_text|length > 200 %}...{% endif %}
                            </div>
                        </div>
                        
                        <div class="article-footer">
                            <div class="article-stats">
                                üëç {{ article.likes or 0 }} | üëÅÔ∏è {{ article.views or 0 }}
                            </div>
                            <div class="article-actions">
                                <a href="/lab8/article/{{ article.id }}/" class="btn btn-primary">–ß–∏—Ç–∞—Ç—å</a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% elif search_query and user_articles|length == 0 %}
                <div class="empty-message">
                    <h3>üåê –ù–µ—Ç –ø—É–±–ª–∏—á–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
                    <p>–ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø—É–±–ª–∏—á–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.</p>
                </div>
            {% endif %}
        {% endif %}

    {% else %}
        <!-- –î–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
        <div style="background: #e6f7ff; padding: 25px; border-radius: 8px; margin: 30px 0; text-align: center;">
            <h3 style="color: #4364ac; margin-bottom: 15px;">üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h3>
            <p style="font-size: 16px; color: #333; margin-bottom: 20px;">
                –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –ø—É–±–ª–∏—á–Ω—ã–µ —Å—Ç–∞—Ç—å–∏ –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.<br>
                –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π –∏ –¥–æ—Å—Ç—É–ø–∞ –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è.
            </p>
            <div style="display: flex; gap: 15px; justify-content: center;">
                <a href="/lab8/register/" class="btn btn-primary" style="padding: 12px 25px;">üìù –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
                <a href="/lab8/login/" class="btn btn-secondary" style="padding: 12px 25px;">üîë –í–æ–π—Ç–∏</a>
            </div>
        </div>

        <!-- –ü—É–±–ª–∏—á–Ω—ã–µ —Å—Ç–∞—Ç—å–∏ –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö -->
        {% if all_public_articles %}
            <h3 class="section-title">–ü—É–±–ª–∏—á–Ω—ã–µ —Å—Ç–∞—Ç—å–∏ ({{ all_public_articles|length }})</h3>
            
            {% if search_query %}
                <p style="text-align: center; color: #666; margin-bottom: 20px;">
                    –ü–æ –∑–∞–ø—Ä–æ—Å—É "{{ search_query }}" –Ω–∞–π–¥–µ–Ω–æ {{ all_public_articles|length }} –ø—É–±–ª–∏—á–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π
                </p>
            {% endif %}
            
            <div class="article-grid">
                {% for article in all_public_articles %}
                <div class="article-card">
                    <div class="article-header">
                        <h3 class="article-title">{{ article.title }}</h3>
                        <div class="article-meta">
                            <span>–ê–≤—Ç–æ—Ä: {{ get_author_name(article.login_id) }}</span>
                            <span class="article-badge badge-public">üì¢ –ü—É–±–ª–∏—á–Ω–∞—è</span>
                        </div>
                    </div>
                    
                    <div class="article-content">
                        <div class="article-preview">
                            {{ article.article_text[:200] }}
                            {% if article.article_text|length > 200 %}...{% endif %}
                        </div>
                    </div>
                    
                    <div class="article-footer">
                        <div class="article-stats">
                            üëç {{ article.likes or 0 }} | üëÅÔ∏è {{ article.views or 0 }}
                        </div>
                        <div class="article-actions">
                            <a href="/lab8/article/{{ article.id }}/" class="btn btn-primary">–ß–∏—Ç–∞—Ç—å</a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="no-results">
                {% if search_query %}
                    <h3>üòï –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
                    <p>–ü–æ –∑–∞–ø—Ä–æ—Å—É "{{ search_query }}" –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø—É–±–ª–∏—á–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π.</p>
                {% else %}
                    <h3>üì≠ –ü–æ–∫–∞ –Ω–µ—Ç –ø—É–±–ª–∏—á–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π</h3>
                    <p>–ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ —Å–æ–∑–¥–∞—Å—Ç —Å—Ç–∞—Ç—å—é! <a href="/lab8/register/">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å</a> –∏–ª–∏ <a href="/lab8/login/">–≤–æ–π–¥–∏—Ç–µ</a>.</p>
                {% endif %}
            </div>
        {% endif %}
    {% endif %}
</div>

<!-- JavaScript –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.querySelector('.search-input');
    const searchForm = document.querySelector('.search-form');
    
    // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞
    if (searchInput && !searchInput.value) {
        searchInput.focus();
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∞–≤–∏—à–∏ Enter –¥–ª—è –ø–æ–∏—Å–∫–∞
    if (searchInput) {
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                searchForm.submit();
            }
        });
    }
});
</script>
{% endblock %}