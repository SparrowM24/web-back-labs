{% extends "base.html" %}

{% block lab %}–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 9{% endblock %}

{% block main %}
    <h1>üéÑ –ù–æ–≤–æ–≥–æ–¥–Ω–∏–µ –ü–æ–¥–∞—Ä–∫–∏ üéÅ</h1>
    
    <!-- –ü–∞–Ω–µ–ª—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
    <div class="info-panel">
        <div class="user-info">
            {% if is_authenticated %}
                <span>üë§ {{ login }}</span>
                <a href="/lab9/logout" class="auth-btn logout-btn">–í—ã–π—Ç–∏</a>
            {% else %}
                <span>üë§ –ì–æ—Å—Ç—å</span>
                <a href="/lab5/login" class="auth-btn login-btn">–í–æ–π—Ç–∏</a>
                <a href="/lab5/register" class="auth-btn register-btn">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            {% endif %}
        </div>
        
        <div class="game-info">
            <p>–û—Ç–∫—Ä—ã—Ç–æ –∫–æ—Ä–æ–±–æ–∫: <span id="opened-count">0</span> –∏–∑ 3</p>
            <p>–û—Å—Ç–∞–ª–æ—Å—å –Ω–µ–æ—Ç–∫—Ä—ã—Ç—ã—Ö: <span id="remaining">10</span></p>
            <div class="buttons">
                <button id="reset-btn" class="reset-btn">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
                {% if is_authenticated %}
                    <button id="refill-btn" class="refill-btn">üéÖ –î–µ–¥ –ú–æ—Ä–æ–∑</button>
                {% endif %}
            </div>
        </div>
        
        <div class="premium-info" id="premium-info" style="display: none;">
            <p>üéÅ <strong>–ü—Ä–µ–º–∏–∞–ª—å–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏ (6-10)</strong> –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º!</p>
        </div>
    </div>
    
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–æ—Ä–æ–±–æ–∫ -->
    <div id="boxes-container" class="boxes-container">
        <!-- –ö–æ—Ä–æ–±–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è -->
    <div id="message" class="message-container" style="display: none;">
        <div class="message-content">
            <button onclick="closeMessage()" class="close-btn">√ó</button>
            <h2>üéâ –ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ! üéâ</h2>
            <p id="congrat-text"></p>
            <div id="gift-display" style="margin: 20px auto; text-align: center;">
                <img id="gift-image" src="" alt="–ü–æ–¥–∞—Ä–æ–∫" style="max-width: 200px; max-height: 200px; display: none;">
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div id="auth-modal" class="modal-container" style="display: none;">
        <div class="modal-content">
            <button onclick="closeAuthModal()" class="close-btn">√ó</button>
            <h2>üîí –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
            <p>–≠—Ç–æ—Ç –ø–æ–¥–∞—Ä–æ–∫ –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.</p>
            <div class="modal-buttons">
                <a href="/lab5/login" class="modal-btn login-modal-btn">–í–æ–π—Ç–∏</a>
                <a href="/lab5/register" class="modal-btn register-modal-btn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
                <button onclick="closeAuthModal()" class="modal-btn cancel-btn">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>
    
    <style>
        /* HEADER –°–¢–ò–õ–ò - –£–º–µ–Ω—å—à–µ–Ω–Ω—ã–π */
        header {
            background: linear-gradient(135deg, rgba(26, 41, 128, 0.95), rgba(38, 208, 206, 0.95));
            backdrop-filter: blur(10px);
            padding: 15px 0; /* –£–º–µ–Ω—å—à–∏–ª–∏ padding */
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);
            color: #ffeb3b;
            min-height: 70px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
        }

        /* FOOTER –°–¢–ò–õ–ò - –£–º–µ–Ω—å—à–µ–Ω–Ω—ã–π */
        footer {
            background: linear-gradient(135deg, rgba(26, 41, 128, 0.9), rgba(38, 208, 206, 0.9));
            padding: 20px 0 15px; /* –£–º–µ–Ω—å—à–∏–ª–∏ padding */
            margin-top: 50px; /* –£–º–µ–Ω—å—à–∏–ª–∏ –æ—Ç—Å—Ç—É–ø */
            box-shadow: 0 -5px 25px rgba(0, 0, 0, 0.3);
            color: #ffeb3b;
            min-height: 120px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
        }

        body {
            background: linear-gradient(135deg, #1a2980, #26d0ce, #1a2980);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite; /* –î–æ–±–∞–≤–∏–ª–∏ –∞–Ω–∏–º–∞—Ü–∏—é */
            color: white;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            overflow-x: hidden;
            position: relative;
        }
        
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .container {
            padding: 15px; /* –£–º–µ–Ω—å—à–∏–ª–∏ padding */
            position: relative;
            z-index: 2;
            min-height: calc(100vh - 190px); /* –£—á–∏—Ç—ã–≤–∞–µ–º –≤—ã—Å–æ—Ç—É header –∏ footer */
        }
        
        h1 {
            text-align: center;
            color: #FFD700;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.5);
            font-size: 2.2em; /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–∑–º–µ—Ä */
            margin: 10px 0 20px 0; /* –£–º–µ–Ω—å—à–∏–ª–∏ –æ—Ç—Å—Ç—É–ø—ã */
            padding-top: 10px;
        }
        
        .info-panel {
            background: rgba(255, 255, 255, 0.15);
            padding: 20px; /* –£–º–µ–Ω—å—à–∏–ª–∏ padding */
            border-radius: 15px; /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–¥–∏—É—Å */
            margin: 15px auto; /* –£–º–µ–Ω—å—à–∏–ª–∏ –æ—Ç—Å—Ç—É–ø—ã */
            max-width: 800px; /* –£–º–µ–Ω—å—à–∏–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —à–∏—Ä–∏–Ω—É */
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 215, 0, 0.8);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px; /* –£–º–µ–Ω—å—à–∏–ª–∏ –æ—Ç—Å—Ç—É–ø—ã */
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .user-info span {
            font-size: 1.1em; /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–∑–º–µ—Ä */
            color: #FFD700;
            font-weight: bold;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }
        
        .auth-btn {
            padding: 8px 20px; /* –£–º–µ–Ω—å—à–∏–ª–∏ padding */
            border-radius: 20px; /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–¥–∏—É—Å */
            text-decoration: none;
            color: white;
            font-weight: bold;
            margin-left: 10px; /* –£–º–µ–Ω—å—à–∏–ª–∏ –æ—Ç—Å—Ç—É–ø */
            transition: all 0.3s ease;
            border: 2px solid transparent;
            font-size: 0.9em; /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–∑–º–µ—Ä */
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        .login-btn {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
        }
        
        .login-btn:hover {
            background: linear-gradient(135deg, #45a049, #1B5E20);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }
        
        .logout-btn {
            background: linear-gradient(135deg, #f44336, #c62828);
        }
        
        .logout-btn:hover {
            background: linear-gradient(135deg, #d32f2f, #b71c1c);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(244, 67, 54, 0.4);
        }
        
        .register-btn {
            background: linear-gradient(135deg, #2196F3, #1565C0);
        }
        
        .register-btn:hover {
            background: linear-gradient(135deg, #1976D2, #0D47A1);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.4);
        }
        
        .game-info {
            text-align: center;
            padding: 12px; /* –£–º–µ–Ω—å—à–∏–ª–∏ padding */
        }
        
        .game-info p {
            font-size: 1.1em; /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–∑–º–µ—Ä */
            margin: 10px 0; /* –£–º–µ–Ω—å—à–∏–ª–∏ –æ—Ç—Å—Ç—É–ø—ã */
            color: #E3F2FD;
            font-weight: 500;
        }
        
        .game-info p span {
            color: #FFD700;
            font-weight: bold;
            font-size: 1.2em; /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–∑–º–µ—Ä */
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }
        
        .buttons {
            display: flex;
            justify-content: center;
            gap: 15px; /* –£–º–µ–Ω—å—à–∏–ª–∏ –æ—Ç—Å—Ç—É–ø—ã */
            margin-top: 20px; /* –£–º–µ–Ω—å—à–∏–ª–∏ –æ—Ç—Å—Ç—É–ø */
            flex-wrap: wrap;
        }
        
        .reset-btn, .refill-btn {
            background: linear-gradient(135deg, #FFD700, #FF9800);
            color: #1a2980;
            border: none;
            padding: 12px 25px; /* –£–º–µ–Ω—å—à–∏–ª–∏ padding */
            border-radius: 25px; /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–¥–∏—É—Å */
            font-size: 1em; /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–∑–º–µ—Ä */
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 215, 0, 0.8);
            min-width: 160px; /* –£–º–µ–Ω—å—à–∏–ª–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —à–∏—Ä–∏–Ω—É */
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }
        
        .reset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(255, 215, 0, 0.5);
            background: linear-gradient(135deg, #FFE44D, #FFA726);
        }
        
        .refill-btn {
            background: linear-gradient(135deg, #E91E63, #AD1457);
            color: white;
            font-size: 1em; /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–∑–º–µ—Ä */
            border: 2px solid rgba(233, 30, 99, 0.8);
        }
        
        .refill-btn:hover {
            background: linear-gradient(135deg, #C2185B, #880E4F);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(233, 30, 99, 0.5);
        }
        
        .premium-info {
            background: linear-gradient(135deg, rgba(233, 30, 99, 0.25), rgba(173, 20, 87, 0.25));
            border: 2px solid rgba(233, 30, 99, 0.8);
            border-radius: 12px; /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–¥–∏—É—Å */
            padding: 15px; /* –£–º–µ–Ω—å—à–∏–ª–∏ padding */
            margin-top: 20px; /* –£–º–µ–Ω—å—à–∏–ª–∏ –æ—Ç—Å—Ç—É–ø */
            text-align: center;
            backdrop-filter: blur(5px);
        }
        
        .premium-info p {
            margin: 0;
            font-size: 1em; /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–∑–º–µ—Ä */
            color: #FFCCD2;
            font-weight: 500;
        }
        
        /* –ö–û–†–û–ë–ö–ò - –°–î–ï–õ–ê–ï–ú –ú–ï–ù–¨–®–ï –ò –§–ò–ö–°–ò–†–û–í–ê–ù–ù–û–ì–û –†–ê–ó–ú–ï–†–ê */
        .boxes-container {
            position: relative;
            width: 90%;
            height: 50vh; /* –£–º–µ–Ω—å—à–∏–ª–∏ –≤—ã—Å–æ—Ç—É */
            min-height: 400px; /* –£–º–µ–Ω—å—à–∏–ª–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –≤—ã—Å–æ—Ç—É */
            margin: 20px auto; /* –£–º–µ–Ω—å—à–∏–ª–∏ –æ—Ç—Å—Ç—É–ø—ã */
            border: 3px dashed rgba(255, 215, 0, 0.7);
            border-radius: 15px; /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–¥–∏—É—Å */
            overflow: hidden;
            background: rgba(0, 0, 0, 0.25);
            max-width: 1100px; /* –£–º–µ–Ω—å—à–∏–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —à–∏—Ä–∏–Ω—É */
            backdrop-filter: blur(5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }
        
        /* –ö–û–†–û–ë–ö–ò –§–ò–ö–°–ò–†–û–í–ê–ù–ù–û–ì–û –†–ê–ó–ú–ï–†–ê */
        .gift-box {
            position: absolute;
            width: 80px !important; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ */
            height: 80px !important; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
            border: 2px solid #e53935; /* –£–º–µ–Ω—å—à–∏–ª–∏ –≥—Ä–∞–Ω–∏—Ü—É */
            border-radius: 15px; /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–¥–∏—É—Å */
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-origin: center;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4); /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ç–µ–Ω—å */
            overflow: hidden;
            background: linear-gradient(135deg, #ffbf47, #ffeb3b);
            z-index: 1;
        }
        
        /* –û–¢–ö–†–´–¢–´–ï –ü–û–î–ê–†–ö–ò */
        .gift-box.opened {
            background: linear-gradient(135deg, #616161, #757575) !important;
            border-color: #9e9e9e !important;
            cursor: default;
            opacity: 0.35 !important;
            transform: scale(0.9) !important; /* –£–º–µ–Ω—å—à–∏–ª–∏ –º–∞—Å—à—Ç–∞–± */
            box-shadow: 0 2px 4px rgba(0,0,0,0.2) !important;
            filter: grayscale(100%) brightness(0.6) !important;
            z-index: -100;
        }
        
        .gift-box.opened .gift-box-image {
            opacity: 0.4 !important;
            filter: grayscale(100%) brightness(0.5) !important;
        }
        
        .gift-box.opened::before {
            position: absolute;
            top: 3px; /* –£–º–µ–Ω—å—à–∏–ª–∏ –æ—Ç—Å—Ç—É–ø */
            right: 3px;
            color: #4CAF50;
            font-size: 1.2em; /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–∑–º–µ—Ä */
            font-weight: bold;
            text-shadow: 0 0 3px rgba(0,0,0,0.8);
            z-index: 3;
        }
        
        .gift-box.locked {
            background: linear-gradient(135deg, #424242, #616161);
            cursor: not-allowed;
            border-color: #757575;
            opacity: 0.8;
        }
        
        .gift-box.locked .gift-box-image {
            filter: grayscale(70%) brightness(0.7);
            opacity: 0.7;
        }
        
        .gift-box.locked::after {
            content: "üîí";
            position: absolute;
            top: 5px; /* –£–º–µ–Ω—å—à–∏–ª–∏ –æ—Ç—Å—Ç—É–ø */
            right: 5px;
            font-size: 1em; /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–∑–º–µ—Ä */
            z-index: 2;
            text-shadow: 0 0 3px rgba(0,0,0,0.8);
        }
        
        .gift-box-image {
            width: 60px !important; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ */
            height: 60px !important; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
            object-fit: contain;
            transition: all 0.3s ease;
            border-radius: 4px; /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–¥–∏—É—Å */
        }
        
        .gift-box:hover:not(.opened):not(.locked) {
            transform: scale(1.2) rotate(5deg); /* –£–º–µ–Ω—å—à–∏–ª–∏ –º–∞—Å—à—Ç–∞–± */
            box-shadow: 0 0 15px gold, 0 8px 20px rgba(0,0,0,0.5);
            z-index: 10;
            border-color: #FFD700;
        }
        
        .gift-box:hover:not(.opened):not(.locked) .gift-box-image {
            transform: scale(1.1);
        }
        
        /* –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê - –£–ú–ï–ù–¨–®–ï–ù–ù–´–ï */
        .modal-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #1a237e, #283593);
            padding: 25px; /* –£–º–µ–Ω—å—à–∏–ª–∏ padding */
            border-radius: 20px; /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–¥–∏—É—Å */
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.6);
            z-index: 1001;
            min-width: 350px; /* –£–º–µ–Ω—å—à–∏–ª–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —à–∏—Ä–∏–Ω—É */
            max-width: 450px; /* –£–º–µ–Ω—å—à–∏–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —à–∏—Ä–∏–Ω—É */
            border: 2px solid #FFD700; /* –£–º–µ–Ω—å—à–∏–ª–∏ –≥—Ä–∞–Ω–∏—Ü—É */
            color: white;
            backdrop-filter: blur(8px);
        }
        
        .modal-content {
            text-align: center;
        }
        
        .modal-content h2 {
            color: #FFD700;
            margin-bottom: 20px; /* –£–º–µ–Ω—å—à–∏–ª–∏ –æ—Ç—Å—Ç—É–ø */
            font-size: 1.5em; /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–∑–º–µ—Ä */
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }
        
        .modal-content p {
            font-size: 1em; /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–∑–º–µ—Ä */
            line-height: 1.4;
            color: #E3F2FD;
            margin-bottom: 20px;
        }
        
        .modal-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px; /* –£–º–µ–Ω—å—à–∏–ª–∏ –æ—Ç—Å—Ç—É–ø—ã */
            margin-top: 20px; /* –£–º–µ–Ω—å—à–∏–ª–∏ –æ—Ç—Å—Ç—É–ø */
        }
        
        .modal-btn {
            padding: 12px; /* –£–º–µ–Ω—å—à–∏–ª–∏ padding */
            border-radius: 25px; /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–¥–∏—É—Å */
            text-decoration: none;
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 0.9em; /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–∑–º–µ—Ä */
            text-align: center;
        }
        
        .login-modal-btn {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
        }
        
        .login-modal-btn:hover {
            background: linear-gradient(135deg, #45a049, #1B5E20);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }
        
        .register-modal-btn {
            background: linear-gradient(135deg, #2196F3, #1565C0);
        }
        
        .register-modal-btn:hover {
            background: linear-gradient(135deg, #1976D2, #0D47A1);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.4);
        }
        
        .cancel-btn {
            background: linear-gradient(135deg, #757575, #424242);
        }
        
        .cancel-btn:hover {
            background: linear-gradient(135deg, #616161, #212121);
            transform: translateY(-2px);
        }
        
        .message-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #1a237e, #283593);
            padding: 30px; /* –£–º–µ–Ω—å—à–∏–ª–∏ padding */
            border-radius: 20px; /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–¥–∏—É—Å */
            box-shadow: 0 15px 40px rgba(255, 215, 0, 0.7);
            z-index: 1000;
            min-width: 380px; /* –£–º–µ–Ω—å—à–∏–ª–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —à–∏—Ä–∏–Ω—É */
            max-width: 550px; /* –£–º–µ–Ω—å—à–∏–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —à–∏—Ä–∏–Ω—É */
            border: 2px solid #FFD700; /* –£–º–µ–Ω—å—à–∏–ª–∏ –≥—Ä–∞–Ω–∏—Ü—É */
            color: white;
            backdrop-filter: blur(12px);
        }
        
        .message-content {
            text-align: center;
        }
        
        .message-content h2 {
            color: #FFD700;
            margin-bottom: 20px; /* –£–º–µ–Ω—å—à–∏–ª–∏ –æ—Ç—Å—Ç—É–ø */
            font-size: 1.8em; /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–∑–º–µ—Ä */
            text-shadow: 2px 2px 5px rgba(0,0,0,0.5);
        }
        
        #congrat-text {
            font-size: 1.1em; /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–∑–º–µ—Ä */
            line-height: 1.5;
            color: #E3F2FD;
            margin: 15px 0; /* –£–º–µ–Ω—å—à–∏–ª–∏ –æ—Ç—Å—Ç—É–ø—ã */
            padding: 12px; /* –£–º–µ–Ω—å—à–∏–ª–∏ padding */
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px; /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–¥–∏—É—Å */
            border-left: 3px solid #FFD700; /* –£–º–µ–Ω—å—à–∏–ª–∏ –≥—Ä–∞–Ω–∏—Ü—É */
        }
        
        .close-btn {
            position: absolute;
            top: 10px; /* –£–º–µ–Ω—å—à–∏–ª–∏ –æ—Ç—Å—Ç—É–ø */
            right: 15px;
            background: none;
            border: none;
            color: white;
            font-size: 1.8em; /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–∑–º–µ—Ä */
            cursor: pointer;
            line-height: 1;
            transition: all 0.3s;
            width: 35px; /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–∑–º–µ—Ä */
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .close-btn:hover {
            color: #FFD700;
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(90deg);
        }
        
        /* –°–ù–ï–ñ–ò–ù–ö–ò */
        .snowflake {
            position: fixed;
            background: white;
            border-radius: 50%;
            opacity: 0;
            animation: fall linear infinite;
            z-index: 1;
            pointer-events: none;
        }
        
        @keyframes fall {
            0% {
                transform: translateY(-100px) translateX(0px) rotate(0deg);
                opacity: 0.8;
            }
            10% {
                opacity: 0.9;
            }
            90% {
                opacity: 0.8;
            }
            100% {
                transform: translateY(calc(100vh + 100px)) translateX(20px) rotate(360deg);
                opacity: 0;
            }
        }
        
        #gift-image {
            border-radius: 12px; /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–¥–∏—É—Å */
            border: 3px solid #FFD700; /* –£–º–µ–Ω—å—à–∏–ª–∏ –≥—Ä–∞–Ω–∏—Ü—É */
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
            padding: 12px; /* –£–º–µ–Ω—å—à–∏–ª–∏ padding */
            background: white;
            max-width: 200px; /* –£–º–µ–Ω—å—à–∏–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —à–∏—Ä–∏–Ω—É */
            max-height: 200px; /* –£–º–µ–Ω—å—à–∏–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –≤—ã—Å–æ—Ç—É */
            margin: 15px auto; /* –£–º–µ–Ω—å—à–∏–ª–∏ –æ—Ç—Å—Ç—É–ø—ã */
        }
        
    </style>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const container = document.getElementById('boxes-container');
            const messageDiv = document.getElementById('message');
            const authModal = document.getElementById('auth-modal');
            const giftImage = document.getElementById('gift-image');
            const congratText = document.getElementById('congrat-text');
            const openedCountSpan = document.getElementById('opened-count');
            const remainingSpan = document.getElementById('remaining');
            const resetBtn = document.getElementById('reset-btn');
            const refillBtn = document.getElementById('refill-btn');
            const premiumInfo = document.getElementById('premium-info');
            
            let isAuthenticated = false;
            
            // –£–õ–£–ß–®–ï–ù–ù–´–ï –°–ù–ï–ñ–ò–ù–ö–ò - –Ω–∞—á–Ω–µ–º –ø–∞–¥–µ–Ω–∏–µ –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ —ç–∫—Ä–∞–Ω–∞
            createSnowflakes();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ—Ä–æ–±–∫–∏
            function loadBoxes() {
                fetch('/lab9/get_boxes')
                    .then(response => response.json())
                    .then(data => {
                        console.log('–î–∞–Ω–Ω—ã–µ –∫–æ—Ä–æ–±–æ–∫:', data);
                        container.innerHTML = '';
                        isAuthenticated = data.is_authenticated;
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–µ–º–∏–∞–ª—å–Ω—ã—Ö –ø–æ–¥–∞—Ä–∫–∞—Ö
                        if (data.premium_count > 0 && !isAuthenticated) {
                            premiumInfo.style.display = 'block';
                        } else {
                            premiumInfo.style.display = 'none';
                        }
                        
                        data.boxes.forEach(box => {
                            const boxDiv = document.createElement('div');
                            
                            // –ö–ª–∞—Å—Å—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è
                            let className = 'gift-box';
                            if (box.opened) {
                                className += ' opened';
                            }
                            if (box.is_locked) {
                                className += ' locked';
                            }
                            boxDiv.className = className;
                            
                            boxDiv.style.top = box.top + '%';
                            boxDiv.style.left = box.left + '%';
                            boxDiv.dataset.id = box.id;
                            boxDiv.dataset.congrat = box.congrat;
                            boxDiv.dataset.gift = box.gift_image;
                            boxDiv.dataset.isPremium = box.is_premium;
                            boxDiv.dataset.isAvailable = box.is_available;
                            boxDiv.title = box.message || '';
                            
                            // –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–¥–∞—Ä–∫–∞
                            const giftImg = document.createElement('img');
                            giftImg.src = box.gift_image;
                            giftImg.alt = '–ü–æ–¥–∞—Ä–æ–∫';
                            giftImg.className = 'gift-box-image';
                            
                            // –î–ª—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ—Ä–æ–±–æ–∫ –¥–æ–±–∞–≤–ª—è–µ–º –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ (inline-—Å—Ç–∏–ª–∏)
                            if (box.is_locked) {
                                giftImg.style.opacity = '0.6';
                                giftImg.style.filter = 'grayscale(50%) brightness(0.7)';
                            }
                            
                            // –í–ù–ò–ú–ê–ù–ò–ï: –£–ë–†–ê–õ–ò inline-—Å—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∫–æ—Ä–æ–±–æ–∫!
                            // –¢–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ –∫–ª–∞—Å—Å .opened, CSS —Å–∞–º –≤—Å–µ —Å–¥–µ–ª–∞–µ—Ç
                            
                            boxDiv.appendChild(giftImg);
                            
                            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ—Ä–æ–±–æ–∫
                            if (box.is_available && !box.opened) {
                                boxDiv.addEventListener('click', openBox);
                            } else if (box.is_locked) {
                                boxDiv.addEventListener('click', function() {
                                    showAuthModal();
                                });
                            }
                            
                            container.appendChild(boxDiv);
                        });
                        
                        openedCountSpan.textContent = data.opened_count;
                        remainingSpan.textContent = data.remaining;
                    })
                    .catch(error => {
                        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ—Ä–æ–±–æ–∫:', error);
                        showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ—Ä–æ–±–æ–∫', true);
                    });
            }
            
                        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–æ—Ä–æ–±–∫–∏
                        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–æ—Ä–æ–±–∫–∏
            // –§—É–Ω–∫—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–æ—Ä–æ–±–∫–∏
            function openBox(event) {
                const boxId = event.currentTarget.dataset.id;
                const congrat = event.currentTarget.dataset.congrat;
                const gift = event.currentTarget.dataset.gift;
                
                fetch(`/lab9/open_box/${boxId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        if (data.requires_auth) {
                            showAuthModal();
                        } else {
                            showMessage(data.error, true);
                        }
                    } else {
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –ø–æ–¥–∞—Ä–æ–∫
                        congratText.textContent = congrat;
                        giftImage.src = gift;
                        giftImage.style.display = 'block';
                        messageDiv.style.display = 'block';
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏
                        openedCountSpan.textContent = data.opened_count;
                        remainingSpan.textContent = data.remaining;
                        
                        // –í–ê–ñ–ù–û: –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ—Ä–æ–±–∫–∏ –∑–∞–Ω–æ–≤–æ, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                        loadBoxes();
                        
                        showMessage('–í—ã –æ—Ç–∫—Ä—ã–ª–∏ –∫–æ—Ä–æ–±–∫—É!', false);
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∫–æ—Ä–æ–±–∫–∏:', error);
                    showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∫–æ—Ä–æ–±–∫–∏', true);
                });
            }
                        
            // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            function showAuthModal() {
                authModal.style.display = 'block';
            }
            
            // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            function closeAuthModal() {
                authModal.style.display = 'none';
            }
            
            window.closeAuthModal = closeAuthModal;
            
            // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
            function showMessage(text, isError) {
                const msgDiv = document.createElement('div');
                msgDiv.className = 'message ' + (isError ? 'error' : 'success');
                msgDiv.textContent = text;
                msgDiv.style.position = 'fixed';
                msgDiv.style.top = '20px';
                msgDiv.style.right = '20px';
                msgDiv.style.padding = '12px 25px';
                msgDiv.style.borderRadius = '8px';
                msgDiv.style.color = 'white';
                msgDiv.style.zIndex = '1000';
                msgDiv.style.backgroundColor = isError ? '#ff4444' : '#44ff44';
                msgDiv.style.boxShadow = '0 4px 15px rgba(0,0,0,0.4)';
                msgDiv.style.fontSize = '1.1em';
                msgDiv.style.fontWeight = '500';
                
                document.body.appendChild(msgDiv);
                
                setTimeout(() => {
                    if (msgDiv.parentNode) {
                        msgDiv.remove();
                    }
                }, 3000);
            }
            
            // –°–∫—Ä—ã—Ç–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ –ø–æ–¥–∞—Ä–∫–µ
            window.closeMessage = function() {
                messageDiv.style.display = 'none';
                giftImage.style.display = 'none';
            }
            
            // –°–±—Ä–æ—Å
            resetBtn.addEventListener('click', function() {
                fetch('/lab9/reset', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        loadBoxes();
                        showMessage('–ò–≥—Ä–∞ —Å–±—Ä–æ—à–µ–Ω–∞! –í—Å–µ –ø–æ–¥–∞—Ä–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã.', false);
                        closeMessage();
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞:', error);
                    showMessage('–û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞', true);
                });
            });
            
            // –ö–Ω–æ–ø–∫–∞ "–î–µ–¥ –ú–æ—Ä–æ–∑" (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö)
            if (refillBtn) {
                refillBtn.addEventListener('click', function() {
                    if (!isAuthenticated) {
                        showAuthModal();
                        return;
                    }
                    
                    fetch('/lab9/refill', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) {
                            showMessage(data.error, true);
                        } else {
                            showMessage('üéÖ –î–µ–¥ –ú–æ—Ä–æ–∑ –Ω–∞–ø–æ–ª–Ω–∏–ª –≤—Å–µ –∫–æ—Ä–æ–±–∫–∏ –∑–∞–Ω–æ–≤–æ!', false);
                            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∫–æ—Ä–æ–±–∫–∏ —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É
                            setTimeout(() => {
                                loadBoxes();
                            }, 1200);
                        }
                    })
                    .catch(error => {
                        console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ—Ä–æ–±–æ–∫:', error);
                        showMessage('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ—Ä–æ–±–æ–∫', true);
                    });
                });
            }
            
            // –£–õ–£–ß–®–ï–ù–ù–û–ï –°–û–ó–î–ê–ù–ò–ï –°–ù–ï–ñ–ò–ù–û–ö
            function createSnowflakes() {
                const snowflakeCount = 80; // –£–≤–µ–ª–∏—á–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–Ω–µ–∂–∏–Ω–æ–∫
                
                for (let i = 0; i < snowflakeCount; i++) {
                    const snowflake = document.createElement('div');
                    snowflake.className = 'snowflake';
                    
                    // –°–ª—É—á–∞–π–Ω—ã–π —Ä–∞–∑–º–µ—Ä –æ—Ç 4 –¥–æ 12px
                    const size = Math.random() * 8 + 4;
                    snowflake.style.width = size + 'px';
                    snowflake.style.height = size + 'px';
                    
                    // –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å
                    const opacity = Math.random() * 0.7 + 0.3;
                    snowflake.style.opacity = '0';
                    
                    // –ù–∞—á–∏–Ω–∞–µ–º –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ —ç–∫—Ä–∞–Ω–∞ (—Å–≤–µ—Ä—Ö—É) –∏ –ø–∞–¥–∞–µ–º –¥–æ —Å–∞–º–æ–≥–æ –Ω–∏–∑–∞ + –∑–∞–ø–∞—Å
                    snowflake.style.left = Math.random() * 100 + 'vw';
                    
                    // –ê–Ω–∏–º–∞—Ü–∏—è - –Ω–∞—á–∏–Ω–∞–µ–º –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ —ç–∫—Ä–∞–Ω–∞ (-100px) –∏ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ–º –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ (+100px)
                    const duration = Math.random() * 10 + 10; // 10-20 —Å–µ–∫—É–Ω–¥
                    const delay = Math.random() * 5; // –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–æ 5 —Å–µ–∫—É–Ω–¥
                    
                    snowflake.style.animationDuration = duration + 's';
                    snowflake.style.animationDelay = delay + 's';
                    
                    // –†–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º—ã —Å–Ω–µ–∂–∏–Ω–æ–∫
                    if (Math.random() > 0.5) {
                        snowflake.style.borderRadius = '50%';
                    } else {
                        snowflake.style.borderRadius = '0%';
                        snowflake.style.transform = 'rotate(45deg)';
                    }
                    
                    // –†–∞–∑–Ω—ã–µ –æ—Ç—Ç–µ–Ω–∫–∏ –±–µ–ª–æ–≥–æ
                    const brightness = Math.random() * 0.3 + 0.7;
                    snowflake.style.backgroundColor = `rgba(255, 255, 255, ${opacity})`;
                    snowflake.style.filter = `brightness(${brightness})`;
                    
                    document.body.appendChild(snowflake);
                }
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ—Ä–æ–±–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
            loadBoxes();
        });
    </script>
{% endblock %}